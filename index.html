<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>smile</title>

    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/font-awesome-4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" href="css/style.css" />

    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>

    <script src="https://aframe.io/releases/0.6.1/aframe.min.js"></script>

    <script src="js/aframe-gif-shader.min.js"></script>
    <script src="js/aframe-gif-component.min.js"></script>

    <script src="js/aframe-vid-shader.min.js"></script>

    <script src="js/aframe-preloader-component.min.js"></script>

</head>

<body>

    <div id="preloaderModal" class="modal instructions-modal" tabindex="-1" role="dialog" style="display: none;">
        <div class="modal-dialog modal-dialog__full" role="document">
            <div class="modal-content vertical-align text-center">
                <div class="col-md-6 col-md-offset-3">
                    <div class="row" style="opacity:0">
                        <div class="col-xs-12">
                            <i class="preloader-modal__ok fa fa-check fa-5x text-success" aria-hidden="true"></i>
                            <i class="preloader-modal__spinner fa fa-cog fa-spin fa-5x fa-fw text-muted" aria-hidden="true"></i>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12">
                            <span class="progress-label">Loading 0%</span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12">
                            <button type="button" class="btn btn-default clearfix" data-dismiss="modal">Start</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <a-scene preloader="autoInject: false; clickToClose: true; autoClose: true; target: #preloaderModal; bar: #preloaderModal .progress-bar; label: #preloaderModal .progress-label; labelText: Loading {0}%; slowLoad: true; doneLabelText: Press Start To Play!;">

        <a-assets>

            <img id="intro-msg-1" src="img/intro-msg-1.jpg" crossorigin="anonymous" preload="true">
            <img id="headphones" src="img/headphones.png" crossorigin="anonymous" preload="true">

            <img id="intro-msg-2" src="img/intro-msg-2.jpg" crossorigin="anonymous" preload="true">
            <img id="cardboard" src="img/cardboard.png" crossorigin="anonymous" preload="true">

            <img id="intro-msg-3" src="img/intro-msg-3.jpg" crossorigin="anonymous" preload="true">
            <img id="rotation" src="img/rotation.png" crossorigin="anonymous" preload="true">

            <img id="poster" src="img/poster.jpg" crossorigin="anonymous" preload="true">

            <img   id="img-1" src="img/img-1.jpg" crossorigin="anonymous" preload="true">
            <audio id="audio-1" src="audio/audio-1.aac" crossorigin="anonymous" preload="true"></audio>
            <img   id="gif-1" src="img/gif-1.gif" crossorigin="anonymous" preload="true">

            <video id="video-2" src="video/video-2.mp4" loop="true" crossorigin="anonymous" preload="true"></video>
            <audio id="audio-2" src="audio/audio-2.aac" crossorigin="anonymous" preload="true"></audio>
            <img   id="gif-2" src="img/gif-2.gif" crossorigin="anonymous" preload="true">

            <video id="video-3" src="video/video-3.mp4" loop="true" crossorigin="anonymous" preload="true"></video>
            <audio id="audio-3" src="audio/audio-3.aac" crossorigin="anonymous" preload="true"></audio>
            <img   id="gif-3" src="img/gif-3.gif" crossorigin="anonymous" preload="true">

            <img   id="img-4" src="img/img-4.jpg" crossorigin="anonymous" preload="true">
            <audio id="audio-4" src="audio/audio-4.aac" crossorigin="anonymous" preload="true"></audio>
            <img   id="gif-4" src="img/gif-4.gif" crossorigin="anonymous" preload="true">

            <img   id="img-5" src="img/img-5.jpg" crossorigin="anonymous" preload="true">
            <audio id="audio-5" src="audio/audio-5.aac" crossorigin="anonymous" preload="true"></audio>
            <img   id="gif-5" src="img/gif-5.gif" crossorigin="anonymous" preload="true">

            <img   id="credits" src="img/credits.jpg" crossorigin="anonymous" preload="true">

        </a-assets>

        <a-sky color="#000"></a-sky>

        <a-camera wasd-controls-enabled="true">
            <a-cursor id="cursor" color="red"></a-cursor>
            <a-plane id="trigger" width="0" height=".01" position="0 -0.25 -.5" color="red"></a-plane>
            <!-- intro -->
            <a-image src="#headphones" opacity="0" position="0 0 -6">
                <a-animation attribute="opacity" from="0" to="1" delay="0" dur="5000"></a-animation>
                <a-animation attribute="opacity" from="1" to="0" delay="5000" dur="5000"></a-animation>
                <a-animation attribute="visible" delay="10000" to="false"></a-animation>
                <a-animation attribute="rotation" dur="5000" fill="forwards" to="0 360 0" repeat="2"></a-animation>
            </a-image>
            <a-image src="#cardboard" opacity="0" position="0 0 -6">
                <a-animation attribute="visible" delay="10000" to="true"></a-animation>
                <a-animation attribute="opacity" from="0" to="1" delay="10000" dur="5000"></a-animation>
                <a-animation attribute="opacity" from="1" to="0" delay="15000" dur="5000"></a-animation>
                <a-animation attribute="visible" delay="20000" to="false"></a-animation>
                <a-animation attribute="rotation" delay="10000" dur="5000" fill="forwards" to="0 360 0" repeat="3"></a-animation>
            </a-image>
            <a-image src="#rotation" opacity="0" position="0 0 -6">
                <a-animation attribute="visible" delay="20000" to="true"></a-animation>
                <a-animation attribute="opacity" from="0" to="1" delay="20000" dur="5000"></a-animation>
                <a-animation attribute="opacity" from="1" to="0" delay="25000" dur="5000"></a-animation>
                <a-animation attribute="visible" delay="30000" to="false"></a-animation>
                <a-animation attribute="rotation" delay="20000" dur="5000" fill="forwards" to="0 360 0" repeat="3"></a-animation>
            </a-image>
            <a-plane src="#intro-msg-1" height="0.7" width="6" opacity="0" color="white" position=".12 1 -6">
                <a-animation attribute="opacity" from="0" to="1" dur="5000"></a-animation>
                <a-animation attribute="opacity" from="1" to="0" delay="5000" dur="5000"></a-animation>
                <a-animation attribute="visible" delay="10000" to="false"></a-animation>
            </a-plane>
            <a-plane src="#intro-msg-2" height="0.7" width="6" opacity="0" color="white" position=".12 1 -6">
                <a-animation attribute="visible" delay="10000" to="true"></a-animation>
                <a-animation attribute="opacity" from="0" to="1" delay="10000" dur="5000"></a-animation>
                <a-animation attribute="opacity" from="1" to="0" delay="15000" dur="5000"></a-animation>
                <a-animation attribute="visible" delay="20000" to="false"></a-animation>
            </a-plane>
            <a-plane src="#intro-msg-3" height="0.7" width="6" opacity="0" color="white" position=".12 1 -6">
                <a-animation attribute="visible" delay="20000" to="true"></a-animation>
                <a-animation attribute="opacity" from="0" to="1" delay="20000" dur="5000"></a-animation>
                <a-animation attribute="opacity" from="1" to="0" delay="25000" dur="5000"></a-animation>
                <a-animation attribute="visible" delay="30000" to="false"></a-animation>
            </a-plane>
            <a-plane src="#poster" opacity="0" width="5" height="2.8" position="0 0 -3">
                <a-animation attribute="opacity" from="0" to="1" delay="30000" dur="5000"></a-animation>
                <a-animation attribute="opacity" from="1" to="0" delay="35000" dur="5000"></a-animation>
                <a-animation id="start" attribute="visible" delay="40000" to="false"></a-animation>
            </a-plane>
            <!-- intro end -->
            <a-plane id="finalCredits" src="#credits" visible="false" width="5" height="2.8" position="0 0 -100"></a-plane>
        </a-camera>

        <a-sphere class="sphereActive" position="0 2 0" radius="5" material="src: #img-1" side="double" visible="false"></a-sphere>
        <a-sphere class="is-video" position="0 2 -100" radius="5" material="shader:video;src:#video-2;side:double;" side="double" visible="false"></a-sphere>

        <a-entity id="action" geometry="primitive:plane;" position="0 -100 0" material="shader:gif; src:url(img/gif-1.gif);" gif=""></a-entity>

        <a-entity id="sound" position="0 1.5 0">
            <a-entity sound="src: #audio-1; volume: 3;"></a-entity>
        </a-entity>

        <!-- elements scene 1 -->
        <!-- ... -->
        <!-- elements scene 2 -->
        <!-- ... -->
        <!-- elements scene 3 -->
        <!-- ... -->
        <!-- elements scene 4 -->
        <!-- ... -->
        <!-- elements scene 5 -->
        <!-- ... -->

    </a-scene>

    <script>

        //SETTINGS
        var currentScene = 0;

        var assets = {
            escene1: {
                esceneBgMaterial: 'img',
                esceneBg: '#img-1',
                esceneSound: '#audio-1',
                actionImg: 'gif-1',
                actionPosition: { x: 0, y: 1.5, z: -1 }
            },
            escene2: {
                esceneBgMaterial: 'video',
                esceneBg: '#video-2',
                esceneSound: '#audio-2',
                actionImg: 'gif-2',
                actionPosition: { x: 0, y: 1.5, z: -1 }
            },
            escene3: {
                esceneBgMaterial: 'video',
                esceneBg: '#video-3',
                esceneSound: '#audio-3',
                actionImg: 'gif-3',
                actionPosition: { x: 0, y: 1.5, z: -1 }
            },
            escene4: {
                esceneBgMaterial: 'img',
                esceneBg: '#img-4',
                esceneSound: '#audio-4',
                actionImg: 'gif-4',
                actionPosition: { x: 0, y: 1.5, z: -1 }
            },
            escene5: {
                esceneBgMaterial: 'img',
                esceneBg: '#img-5',
                esceneSound: '#audio-5',
                actionImg: 'gif-5',
                actionPosition: { x: 0, y: 1.5, z: -1 }
            },
            key: function(n) {
                return this[Object.keys(this)[n]];
            }
        };

        var indexLastScene = 4;
        var triggerAnimation = '<a-animation attribute="width" dur="3000" easing="ease-out" from="0" to="1">';
        var endAnimation = '<a-animation attribute="opacity" from="1" to="0" delay="3000" dur="3000"></a-animation>';

        // APP INIT
        (function() {
            console.log('app init');
        })();

        function init() {
            console.log('you are in escene number: ' + (currentScene + 1));

            document.querySelectorAll('a-sphere')[0].setAttribute('visible', 'true');
            document.querySelectorAll('a-sphere')[1].setAttribute('visible', 'true');
            document.querySelector('#sound a-entity').components.sound.playSound();
        }

        // ENABLE GO TO NEXT ESCENE
        function enableNext() {

            if (currentScene > 0 && currentScene < indexLastScene) {
                if( assets.key(currentScene + 1).esceneBgMaterial == 'video' ){
                    document.querySelector('a-sphere:not(.sphereActive)').setAttribute('material', 'shader:video; src:' + assets.key(currentScene + 1).esceneBg + '; side:double;' );
                    document.querySelector('a-sphere:not(.sphereActive)').classList.add("is-video");
                } else {
                    document.querySelector('a-sphere:not(.sphereActive)').setAttribute('material', 'shader:flat; src:' + assets.key(currentScene + 1).esceneBg );
                    document.querySelector('a-sphere:not(.sphereActive)').classList.remove("is-video");
                }
            }

            action.setAttribute('position', { x: assets.key(currentScene).actionPosition.x, y: assets.key(currentScene).actionPosition.y, z: assets.key(currentScene).actionPosition.z });

            if (currentScene < indexLastScene) {
                ++currentScene;
                console.log('enable go to escene number: ' + (currentScene + 1));
            } else {
                console.log('end');

                action.onmouseenter = function (e) {
                  trigger.innerHTML = '';
                };

                finalCredits.setAttribute('visible', 'true');
                finalCredits.setAttribute('position', { x: 0, y: 0, z: -6 });
                document.querySelector('.sphereActive').innerHTML = endAnimation;
                document.querySelector('.sphereActive').addEventListener('animationend', function(){
                    action.setAttribute('visible', 'false');
                }, false);
            }
        }

        // GO TO NEXT ESCENE
        function goNextScene() {
            console.log('you are in escene number: ' + (currentScene + 1));

            document.querySelectorAll('a-sphere')[0].classList.toggle("sphereActive");
            document.querySelectorAll('a-sphere')[1].classList.toggle("sphereActive");

            action.setAttribute('position', { y: -100 });

            document.querySelector('a-sphere:not(.sphereActive)').setAttribute('material', '');
            document.querySelector('a-sphere:not(.sphereActive)').setAttribute('position', { x: 0, y: 2, z: 100 });
            document.querySelector('.sphereActive').setAttribute('position', { x: 0, y: 2, z: 0 });

            document.querySelector('#sound a-entity').setAttribute('sound', { src: assets.key(currentScene).esceneSound });
            document.querySelector('#sound a-entity').components.sound.playSound();

            if( currentScene == 1 ) {
                togglePlayback();
            }

            if( currentScene == 2 ) {
                togglePlayback();
                togglePlayback();
            }

            action.setAttribute('material', { src: 'url(img/' + assets.key(currentScene).actionImg + '.gif);' });
        }

        //TOGLE PLAY TEXTURE
        function togglePlayback() {
          var el = document.querySelector('.is-video');
          var material = Object.assign({}, el.getAttribute('material'));
          material.pause = !material.pause;
          el.setAttribute('material', material);
        }

        //EVENTS
        start.addEventListener('animationend', init, false);
        sound.addEventListener('sound-ended', enableNext, false);
        trigger.addEventListener('animationend', goNextScene, false);

        preloaderModal.querySelector('button').addEventListener('click', function(){
            document.querySelector('#video-2').play();
            document.querySelector('#video-2').pause();
            document.querySelector('#video-3').play();
            document.querySelector('#video-3').pause();
            togglePlayback();

        }, false);

        action.onmouseenter = function (e) {
          trigger.innerHTML = triggerAnimation;
        };

        action.onmouseleave = function (e) {
          trigger.innerHTML = '';
          trigger.setAttribute('width', 0);
        };

    </script>
</body>

</html>