<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>smile</title>

    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/style.css" />

    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>

    <script src="https://aframe.io/releases/0.6.1/aframe.min.js"></script>

    <script src="js/aframe-gif-shader.min.js"></script>

    <script src="js/aframe-vid-shader.min.js"></script>

    <script src="js/aframe-particle-system-component.min.js"></script>

    <script src="js/aframe-preloader-component.min.js"></script>

</head>

<body>

    <div id="preloaderModal" class="modal instructions-modal" tabindex="-1" role="dialog" style="display: none;">
        <div class="modal-dialog modal-dialog__full" role="document">
            <div class="modal-content vertical-align text-center">
                <div class="col-md-6 col-md-offset-3">
                    <div class="row" style="opacity:0">
                        <div class="col-xs-12">
                            <i class="preloader-modal__ok fa fa-check fa-5x text-success" aria-hidden="true"></i>
                            <i class="preloader-modal__spinner fa fa-cog fa-spin fa-5x fa-fw text-muted" aria-hidden="true"></i>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12">
                            <span class="progress-label">Loading 0%</span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12">
                            <button type="button" class="btn btn-default clearfix" data-dismiss="modal">Start</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <a-scene preloader="autoInject: false; clickToClose: true; autoClose: true; target: #preloaderModal; bar: #preloaderModal .progress-bar; label: #preloaderModal .progress-label; labelText: Loading {0}%; slowLoad: true; doneLabelText: Press Start To Play!;">

        <a-assets>

            <img id="intro-msg-1" src="img/intro-msg-1.jpg" crossorigin="anonymous" preload="true">
            <img id="headphones" src="img/headphones.png" crossorigin="anonymous" preload="true">

            <img id="intro-msg-2" src="img/intro-msg-2.jpg" crossorigin="anonymous" preload="true">
            <img id="cardboard" src="img/cardboard.png" crossorigin="anonymous" preload="true">

            <img id="intro-msg-3" src="img/intro-msg-3.jpg" crossorigin="anonymous" preload="true">
            <img id="rotation" src="img/rotation.png" crossorigin="anonymous" preload="true">

            <img id="poster" src="img/poster.jpg" crossorigin="anonymous" preload="true">

            <img   id="img-1" src="img/img-1.jpg" crossorigin="anonymous" preload="true">
            <audio id="voice-1" src="audio/voice-1.aac" crossorigin="anonymous" preload="true"></audio>
            <audio id="sound-1" src="audio/sound-1.aac" crossorigin="anonymous" preload="true"></audio>
            <img   id="gif-1" src="img/gif-1.gif" crossorigin="anonymous" preload="true">

            <video id="video-2" src="video/video-2.mp4" loop="true" crossorigin="anonymous" preload="true"></video>
            <audio id="voice-2" src="audio/voice-2.aac" crossorigin="anonymous" preload="true"></audio>
            <audio id="sound-2" src="audio/sound-2.aac" crossorigin="anonymous" preload="true"></audio>
            <img   id="gif-2" src="img/gif-2.gif" crossorigin="anonymous" preload="true">

            <video id="video-3" src="video/video-3.mp4" loop="true" crossorigin="anonymous" preload="true"></video>
            <audio id="voice-3" src="audio/voice-3.aac" crossorigin="anonymous" preload="true"></audio>
            <audio id="sound-3" src="audio/sound-3.aac" crossorigin="anonymous" preload="true"></audio>
            <img   id="gif-3" src="img/gif-3.gif" crossorigin="anonymous" preload="true">

            <img   id="img-4" src="img/img-4.jpg" crossorigin="anonymous" preload="true">
            <audio id="voice-4" src="audio/voice-4.aac" crossorigin="anonymous" preload="true"></audio>
            <audio id="sound-4" src="audio/sound-4.aac" crossorigin="anonymous" preload="true"></audio>
            <img   id="gif-4" src="img/gif-4.gif" crossorigin="anonymous" preload="true">

            <img   id="img-5" src="img/img-5.jpg" crossorigin="anonymous" preload="true">
            <audio id="voice-5" src="audio/voice-5.aac" crossorigin="anonymous" preload="true"></audio>
            <audio id="sound-5" src="audio/sound-5.aac" crossorigin="anonymous" preload="true"></audio>
            <img   id="gif-5" src="img/gif-5.gif" crossorigin="anonymous" preload="true">

            <img   id="credits" src="img/credits.jpg" crossorigin="anonymous" preload="true">

        </a-assets>

        <a-sky color="#000"></a-sky>

        <a-camera wasd-controls-enabled="true">
            <a-cursor id="cursor" color="red"></a-cursor>
            <a-plane id="trigger" width="0" height=".007" position="0 -0.25 -.5" color="#0afe55"></a-plane>
            <!-- intro -->
            <a-image src="#headphones" opacity="0" position="0 0 -6">
                <a-animation attribute="opacity" from="0" to="1" delay="0" dur="5000"></a-animation>
                <a-animation attribute="opacity" from="1" to="0" delay="5000" dur="5000"></a-animation>
                <a-animation attribute="visible" delay="10000" to="false"></a-animation>
                <a-animation attribute="rotation" dur="5000" fill="forwards" to="0 360 0" repeat="2"></a-animation>
            </a-image>
            <a-image src="#cardboard" opacity="0" position="0 0 -6">
                <a-animation attribute="visible" delay="10000" to="true"></a-animation>
                <a-animation attribute="opacity" from="0" to="1" delay="10000" dur="5000"></a-animation>
                <a-animation attribute="opacity" from="1" to="0" delay="15000" dur="5000"></a-animation>
                <a-animation attribute="visible" delay="20000" to="false"></a-animation>
                <a-animation attribute="rotation" delay="10000" dur="5000" fill="forwards" to="0 360 0" repeat="3"></a-animation>
            </a-image>
            <a-image src="#rotation" opacity="0" position="0 0 -6">
                <a-animation attribute="visible" delay="20000" to="true"></a-animation>
                <a-animation attribute="opacity" from="0" to="1" delay="20000" dur="5000"></a-animation>
                <a-animation attribute="opacity" from="1" to="0" delay="25000" dur="5000"></a-animation>
                <a-animation attribute="visible" delay="30000" to="false"></a-animation>
                <a-animation attribute="rotation" delay="20000" dur="5000" fill="forwards" to="0 360 0" repeat="3"></a-animation>
            </a-image>
            <a-plane src="#intro-msg-1" height="0.7" width="6" opacity="0" color="white" position=".12 1 -6">
                <a-animation attribute="opacity" from="0" to="1" dur="5000"></a-animation>
                <a-animation attribute="opacity" from="1" to="0" delay="5000" dur="5000"></a-animation>
                <a-animation attribute="visible" delay="10000" to="false"></a-animation>
            </a-plane>
            <a-plane src="#intro-msg-2" height="0.7" width="6" opacity="0" color="white" position=".12 1 -6">
                <a-animation attribute="visible" delay="10000" to="true"></a-animation>
                <a-animation attribute="opacity" from="0" to="1" delay="10000" dur="5000"></a-animation>
                <a-animation attribute="opacity" from="1" to="0" delay="15000" dur="5000"></a-animation>
                <a-animation attribute="visible" delay="20000" to="false"></a-animation>
            </a-plane>
            <a-plane src="#intro-msg-3" height="0.7" width="6" opacity="0" color="white" position=".12 1 -6">
                <a-animation attribute="visible" delay="20000" to="true"></a-animation>
                <a-animation attribute="opacity" from="0" to="1" delay="20000" dur="5000"></a-animation>
                <a-animation attribute="opacity" from="1" to="0" delay="25000" dur="5000"></a-animation>
                <a-animation attribute="visible" delay="30000" to="false"></a-animation>
            </a-plane>
            <a-plane src="#poster" opacity="0" width="2.8" height="2.8" position="0 0 -3">
                <a-animation attribute="opacity" from="0" to="1" delay="30000" dur="5000"></a-animation>
                <a-animation attribute="opacity" from="1" to="0" delay="35000" dur="5000"></a-animation>
                <a-animation id="start" attribute="visible" delay="40000" to="false"></a-animation>
            </a-plane>
            <!-- intro end -->
            <a-plane id="finalCredits" src="#credits" visible="false" width="3" height="3" position="0 0 -100"></a-plane>
        </a-camera>

        <a-sphere class="sphereActive" position="0 2 0" radius="50" material="src: #img-1" rotation="0 180 0" side="double" visible="false" sound="src:#sound-1; autoplay:false; loop:true; volume:4;"></a-sphere>
        <a-sphere class="is-video" position="0 2 -100" radius="50" material="shader:video; src:#video-2; side:double;" rotation="0 180 0" side="double" visible="false" sound="src:#sound-2; autoplay:false; loop:true; volume:4;"></a-sphere>

        <a-entity id="action" geometry="primitive:plane;" position="0 -100 0" material="shader:gif; src:url(img/gif-1.gif); transparent:true; opacity:.7;"></a-entity>

        <a-entity id="sound" position="0 1.5 0">
            <a-entity sound="src: #voice-1; volume: 3;"></a-entity>
        </a-entity>

        <!-- elements scene 1 -->
        <!-- ... -->

        <!-- elements scene 2 -->
        <!-- ... -->

        <!-- elements scene 3 -->
        <!-- ... -->

        <!-- elements scene 4 -->
        <a-entity class="es4-screen" position="-14.5 1.2 14.7" rotation="0 130 0" geometry="primitive:plane; height: 12.5; width: 8" material="shader:gif;src:url(img/es4-screen.gif);opacity:1" visible="false"></a-entity>

        <!-- elements scene 5 -->
		<a-entity class="es5-particle" position="0 2.25 0" particle-system="preset:snow; texture:img/0.png; size:3;" visible="false"></a-entity>
		<a-entity class="es5-particle" position="0 2.25 0" particle-system="preset:snow; texture:img/1.png; size:3;" visible="false"></a-entity>
		<a-entity class="es5-particle" position="0 2.25 0" particle-system="preset:snow; texture:img/0.png; size:2;" visible="false"></a-entity>
		<a-entity class="es5-particle" position="0 2.25 0" particle-system="preset:snow; texture:img/1.png; size:2;" visible="false"></a-entity>
		<a-entity class="es5-particle" position="0 2.25 0" particle-system="preset:rain; texture:img/0.png; size:2;" visible="false"></a-entity>
		<a-entity class="es5-particle" position="0 2.25 0" particle-system="preset:rain; texture:img/1.png; size:2;" visible="false"></a-entity>

    </a-scene>

    <script>

        // APP INIT
        (function() {

            console.log('app start');

            //SETTINGS
            var currentScene = 0;

            var assets = {
                escene1: {
                    esceneBgMaterial: 'img',
                    esceneBg: '#img-1',
                    esceneVoice: '#voice-1',
                    esceneSound: '#sound-1',
                    actionImg: 'gif-1',
                    actionPosition: { x: 0, y: 1.5, z: -1 }
                },
                escene2: {
                    esceneBgMaterial: 'video',
                    esceneBg: '#video-2',
                    esceneVoice: '#voice-2',
                    esceneSound: '#sound-2',
                    actionImg: 'gif-2',
                    actionPosition: { x: 0, y: 1.5, z: -1 }
                },
                escene3: {
                    esceneBgMaterial: 'video',
                    esceneBg: '#video-3',
                    esceneVoice: '#voice-3',
                    esceneSound: '#sound-3',
                    actionImg: 'gif-3',
                    actionPosition: { x: 0, y: 1.5, z: -1 }
                },
                escene4: {
                    esceneBgMaterial: 'img',
                    esceneBg: '#img-4',
                    esceneVoice: '#voice-4',
                    esceneSound: '#sound-4',
                    actionImg: 'gif-4',
                    actionPosition: { x: 0, y: 1.5, z: -1 }
                },
                escene5: {
                    esceneBgMaterial: 'img',
                    esceneBg: '#img-5',
                    esceneVoice: '#voice-5',
                    esceneSound: '#sound-5',
                    actionImg: 'gif-5',
                    actionPosition: { x: 0, y: 1.5, z: -1 }
                },
                key: function(n) {
                    return this[Object.keys(this)[n]];
                }
            };

            var indexLastScene = 4;
            var triggerAnimation = '<a-animation attribute="width" dur="3000" easing="ease-out" from="0" to="0.5">';
            var endAnimation = '<a-animation attribute="opacity" from="1" to="0" delay="3000" dur="3000"></a-animation>';

            var sphere = document.querySelectorAll('a-sphere');
            var sphereActive = document.querySelector('.sphereActive');
            var sphereNoActive = document.querySelector('a-sphere:not(.sphereActive)');
            var voice = document.querySelector('#sound a-entity');
            var es4Screen = document.querySelector('.es4-screen');
            var video2 = document.querySelector('#video-2');
            var video3 = document.querySelector('#video-3');

            function init() {
                console.log('you are in escene number: ' + (currentScene + 1));

                sphere[0].setAttribute('visible', 'true');
                sphere[1].setAttribute('visible', 'true');
                sphereActive.components.sound.playSound();
                voice.components.sound.playSound();
            }

            // ENABLE GO TO NEXT ESCENE
            function enableNext() {

                if (currentScene > 0 && currentScene < indexLastScene) {
                    if( assets.key(currentScene + 1).esceneBgMaterial == 'video' ){
                        sphereNoActive.setAttribute('material', 'shader:video; src:' + assets.key(currentScene + 1).esceneBg + '; side:double;' );
                        sphereNoActive.classList.add("is-video");
                    } else {
                        sphereNoActive.setAttribute('material', 'shader:flat; src:' + assets.key(currentScene + 1).esceneBg );
                        sphereNoActive.classList.remove("is-video");
                    }
                }

                action.setAttribute('position', { x: assets.key(currentScene).actionPosition.x, y: assets.key(currentScene).actionPosition.y, z: assets.key(currentScene).actionPosition.z });

                if (currentScene < indexLastScene) {
                    ++currentScene;
                    console.log('enable go to escene number: ' + (currentScene + 1));
                } else {
                    console.log('end');

                    action.onmouseenter = function (e) {
                      trigger.innerHTML = '';
                    };

                    sphereActive.innerHTML = endAnimation;
                    sphereActive.addEventListener('animationend', function(){
                        action.setAttribute('visible', 'false');
                        finalCredits.setAttribute('visible', 'true');
                        finalCredits.setAttribute('position', { x: 0, y: 0, z: -6 });
                    }, false);
                }
            }

            // GO TO NEXT ESCENE
            function goNextScene() {
                console.log('you are in escene number: ' + (currentScene + 1));

                sphere[0].classList.toggle("sphereActive");
                sphere[1].classList.toggle("sphereActive");

                sphereActive = document.querySelector('.sphereActive');
                sphereNoActive = document.querySelector('a-sphere:not(.sphereActive)');

                action.setAttribute('position', { y: -100 });

                sphereNoActive.setAttribute('material', '');
                sphereNoActive.setAttribute('position', { x: 0, y: 2, z: 100 });
                sphereActive.setAttribute('position', { x: 0, y: 2, z: 0 });

                if( currentScene > 4 ) {
                    sphereNoActive.components.sound.stopSound();
                }

                sphereActive.setAttribute('sound', { src: assets.key(currentScene).esceneSound });
                sphereActive.components.sound.playSound();

                voice.setAttribute('sound', { src: assets.key(currentScene).esceneVoice });
                voice.components.sound.playSound();

                switch(currentScene) {
                    case 1:
                        togglePlayback();
                        break;
                    case 2:
                        togglePlayback();
                        togglePlayback();
                        break;
                    case 3:
                        es4Screen.setAttribute('visible','true');
                        break;
                    case 4:
                        es4Screen.setAttribute('visible','false');
                        var es5Particle = document.querySelectorAll('.es5-particle');
                        for (var i = 0; i < es5Particle.length; i++) {
                            es5Particle[i].setAttribute('visible','true');
                        }
                        break;
                }

                action.setAttribute('material', { src: 'url(img/' + assets.key(currentScene).actionImg + '.gif);' });
            }

            //TOGLE PLAY TEXTURE
            function togglePlayback() {
              var el = document.querySelector('.is-video');
              var material = Object.assign({}, el.getAttribute('material'));
              material.pause = !material.pause;
              el.setAttribute('material', material);
            }

            //EVENTS
            start.addEventListener('animationend', init, false);
            sound.addEventListener('sound-ended', enableNext, false);
            trigger.addEventListener('animationend', goNextScene, false);

            preloaderModal.querySelector('button').addEventListener('click', function(){
                video2.play();
                video2.pause();
                video3.play();
                video3.pause();
                togglePlayback();
            }, false);

            action.onmouseenter = function (e) {
              trigger.innerHTML = triggerAnimation;
            };

            action.onmouseleave = function (e) {
              trigger.innerHTML = '';
              trigger.setAttribute('width', 0);
            };

        })();

    </script>
</body>

</html>